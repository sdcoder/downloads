<style>
    #rates h1 br {
        content: ' ';
        display: inline;
        clear: none;
    }

    #RateTablePurposeOfLoanRow div.text-right, #RateTablePurposeOfLoanRow select, #RateTableCurrentAPRRow, #RateTableRateBeatLogo {
        display: none !important;
    }

    #RateTable div.table {
        background-color: white;
        padding-bottom: 1em;
        margin-bottom: 1em;
    }

    #RateTable table.loanrates tr:nth-of-type(even) {
        background-color: #ededed;
    }

    #LoanCalculator h2 {
        display: none;
    }

    form p.calculated span {
        font-size: 24px;
    }

    form p.calculated {
        line-height: 24px;
    }

    /*RECIPE C*/
    #HowItWorksRow h3 {
        display: none;
    }

    #HowItWorksRow .image-cell {
        height: 100px;
    }

    #HowItWorksRow .close-reveal-modal {
        display: none;
    }

    #HowItWorksRow .image-cell img {
        margin: auto;
        display: block;
        max-height: 90px;
    }

    #HowItWorksRow .text-cell p {
        margin-left: 27px;
    }

    #HowItWorksRow .text-cell h4 {
        font-size: 1.2rem;
    }

    .numberCircle {
        line-height: 16px;
        border-radius: 50%;
        width: 22px;
        height: 22px;
        background: rgb(31, 85, 134);
        border: 2px solid rgb(31, 85, 134);
        color: #fff;
        text-align: center;
        font: 18px Arial, sans-serif;
        display: inline-block;
        margin-right: 5px;
    }

    .calculated_values p.legalcopy-title {
        font-weight: 400;
        font-size: 12px;
        color: rgb(102, 102, 102);
    }

    .records br {
        display: none;
    }
</style>
<script type="text/javascript">
$(function () {
    var allRates = null;
    var ratesGathered = 0;
    var ratesToGather = 10;
    var enabled = $('body').attr('ng-app') == 'LandingPage' && !$('body').hasClass('home') && $('body').hasClass('rates');

    if (!allRates && enabled) {
        // initialize to new auto
        $.post('/Services/Rates', { PurposeOfLoan: 'NewAutoPurchase' }, function (data) {
            allRates = data;
            allRates.PurposeOfLoan = 'NotSelected';
            ratesToGather = allRates.LoanPurposes.length;

            // then find lowest and highest
            for (var i = 0; i < allRates.LoanPurposes.length; i++) {
                var lp = allRates.LoanPurposes[i];

                $.post('/Services/Rates', { PurposeOfLoan: lp.Value }, function (data) {
                    ratesGathered++;

                    for (var la = 0; la < data.RateTable.length; la++) {
                        for (var r = 0; r < data.RateTable[la].Rates.length; r++) {
                            if (data.RateTable[la].Rates[r] && allRates.RateTable[la].Rates[r]) {
                                if (!allRates.RateTable[la].Rates[r].Min || data.RateTable[la].Rates[r].Min < allRates.RateTable[la].Rates[r].Min) {
                                    allRates.RateTable[la].Rates[r].Min = data.RateTable[la].Rates[r].Min;
                                }
                                if (!allRates.RateTable[la].Rates[r].Max || data.RateTable[la].Rates[r].Max > allRates.RateTable[la].Rates[r].Max) {
                                    allRates.RateTable[la].Rates[r].Max = data.RateTable[la].Rates[r].Max;
                                }
                            }
                        }
                    }
                });
            }

            // then initialize the data
            var $rateCalculatorScope = angular.element(document.querySelector('[ng-controller=RateCalculator]')).scope();

            var interval = setInterval(function () {
                if (ratesToGather && ratesGathered >= ratesToGather) {
                    clearInterval(interval);
                    $rateCalculatorScope.$apply(function () {
                        $rateCalculatorScope.rates = allRates;
                    });

                }
            }, 100);


            $rateCalculatorScope.$watch('rates', function (rates, o) {
                console.log(rates);

                if (rates.PurposeOfLoan == 'NotSelected') {
                    $rateCalculatorScope.rates = allRates;
                }
            });

        });
    }

    if (enabled && !$('body').data('mboxed')) {
        $('body').data('mboxed', true);

        $('#rates > div.medium-4.medium-push-8.columns.panel').removeClass('medium-push-8').removeClass('medium-4').addClass('medium-12').removeClass('panel');
        $('#rates > div.medium-8.medium-pull-4.columns').removeClass('medium-8').removeClass('medium-pull-4').addClass('medium-12');
        $('div[ng-controller=RateCalculator]').addClass('panel').prependTo('ack');
        $('#LoanCalculator div.input-values').addClass('medium-8 columns');
        $('#LoanCalculator div.input-values-row').addClass('row');
        $('#LoanCalculator div.calculated_values').addClass('medium-4 columns');

        var monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        var d = new Date();
        var today = monthNames[d.getMonth()] + ' ' + d.getDate() + ', ' + d.getFullYear();
        $('div[ng-controller=RateCalculator]').before('<div class="row"><div class="medium-9 columns"><h1>Annual Percentage Rates (APR)</h1></div><div class="medium-3 columns text-right"><time>' + today + '</time></div></div>');

        $('#LoanCalculator div[data-field="LoanPurpose"]').addClass('medium-12 columns');
        $('#LoanCalculator div[data-field="LoanTerm"]').addClass('medium-4 columns');
        $('#LoanCalculator div[data-field="LoanAmount"]').addClass('medium-4 columns');
        $('#LoanCalculator div[data-field="PaymentMethod"]').addClass('medium-4 columns');

        $('label[for=PurposeOfLoan]').text('For Rates, Select Loan Purpose');
        var $rateBeat = $('#RateTableRateBeatLogo').detach();
        $('div.terms-container').removeClass('medium-12').addClass('medium-9').after('<div class="medium-3 columns"><a class="rate-match" href="/partials/rate-match" data-reveal-id="AjaxModal" data-reveal-ajax="true"><img src="/Content/images/rates/ratebeat_blue.png" alt="rate beat offer"></a></div>');

        //RECIPE C
        if ($('body').attr('ng-app') != 'LandingPage') {
            $('.featured_testimonial').before('<div class="row ruled" id="HowItWorksRow"></div>');
            $('#HowItWorksRow').load('/components/howitworks', function () {
                $('#HowItWorksRow').find('.row').removeClass('row').addClass('medium-4 columns');
                $('#HowItWorksRow').find('.small-3').removeClass('small-3').addClass('small-12 image-cell');
                $('#HowItWorksRow').find('.small-9').removeClass('small-9').addClass('small-12 text-cell');

                var $d2 = $('#HowItWorksRow').find('p.legalcopy').detach();
                $('#Footer').before($d2);

                $('.text-cell h4').each(function () {
                    var str = '<div class="numberCircle">' + $(this).text().substring(0, 1) + '</div>' + $(this).text().substring(2)
                    $(this).html(str);
                });
            });
        }
    }
});
</script>
<script language="javascript">
$(function () {
    $.cookie('TntId', 'RedesignRatesandTerms123', {
        path: '/'
   });
});
</script>