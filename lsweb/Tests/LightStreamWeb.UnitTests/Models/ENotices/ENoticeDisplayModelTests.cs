using LightStreamWeb.Models.ENotices;
using NUnit.Framework;
using System.Diagnostics.CodeAnalysis;

namespace LightStreamWeb.UnitTests.Models.ENotices
{
    [TestFixture]
    [ExcludeFromCodeCoverage]
    public class ENoticeDisplayModelTests : ENoticeDisplayModel
    {
        [Test]
        public void FixUpEdocHtml_Should_Allow_DTDTransforms()
        {
            string original = "\r\n\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head id=\"ctl00_Head1\"><meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><title>\r\n\tA message from LightStream\r\n</title>\r\n    <!-- style in head not respected by gmail, strips out -->\r\n    <style type=\"text/css\">\r\n        p {\r\n            /* this is needed for yahoo mail */\r\n            margin-bottom: 1em;\r\n        }\r\n    </style>\r\n</head>\r\n\r\n<body contenteditable=\"false\" style=\"padding: 0; margin: 0; font-family: Arial, Helvetica, sans-serif; font-size: 10pt; text-align: center;\">\r\n    <style type=\"text/css\">\r\n        @media only screen and (max-width: 480px) {\r\n            /* mobile-specific CSS styles go here */\r\n            table[class=email], table[class=email-content] {\r\n                clear: both;\r\n                width: 320px !important;\r\n                font-size: 13px !important;\r\n            }\r\n\r\n            .email-header {\r\n                margin-bottom: 10px !important;\r\n            }\r\n        }\r\n    </style>\r\n    \r\n    <table id=\"bodyTable\" class=\"email\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" height=\"100%\" width=\"97%\" align=\"center\">\r\n        <tr>\r\n            <td align=\"center\" valign=\"top\">\r\n                <table class=\"email-content\" border=\"0\" cellpadding=\"20\" cellspacing=\"0\" id=\"emailContainer\">\r\n                    <tr>\r\n                        <!-- fluid container up to 660px -->\r\n                        <td width=\"660\">\r\n                            <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\">\r\n                                <!-- Header Content Row -->\r\n                                <tr>\r\n                                    <td align=\"center\" valign=\"top\">\r\n                                        <table class=\"email-header\" style=\"padding-bottom: 20px\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">\r\n                                            <tr>\r\n                                                <td align=\"center\" valign=\"top\">\r\n                                                    <!-- header content goes in here -->\r\n                                                    <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">\r\n                                                        \r\n                                                        \r\n                                                    </table>\r\n                                                </td>\r\n                                            </tr>\r\n                                        </table>\r\n                                    </td>\r\n                                </tr>\r\n\r\n                                <!-- Main Content Row -->\r\n                                <tr>\r\n                                    <td align=\"center\" valign=\"top\">\r\n                                        <!-- main content goes in here -->\r\n                                        <table>\r\n                                            <tr>\r\n                                                <td style=\"vertical-align: top; padding: 0px 7px 0px 7px;\">\r\n                                                    <div style=\"font-family: Arial, Helvetica, sans-serif; font-size: 10pt; text-align: justify;\">\r\n                                                        \r\n    \r\n        <br />\r\n        <br />\r\n        September 27, 2017\r\n        <br />\r\n        <br />\r\n        Reference ID 11177902\r\n        <br />\r\n        <br />\r\n        \r\n        <br />\r\n        <br />\r\n    \r\n\r\n        Dear Tester Tester,\r\n        <br />\r\n        <br />\r\n    \r\n                    Thank you for applying for an installment loan.\r\n                 After reviewing your application, we regret that we are unable\r\n            to approve your request based on the following\r\n    reason:\r\n        \r\n                <ul>\r\n            \r\n                <li>Insufficient credit history</li>\r\n            \r\n                </ul>\r\n            \r\n\r\n        <div id=\"ctl00_EmailContent_uxCounterTermsDiv\" style=\"display:inline; page-break-inside:avoid;\">\r\n                    However, we are able to offer you credit on the following terms:\r\n                    <p />\r\n                    <table style=\"margin-left: 20px; text-align: left;\">\r\n                        <tr>\r\n                            <td style=\"width: 150px\">Amount</td>\r\n                            <td style=\"width: 200px\">$29,500.00</td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td style=\"width: 150px\">Term</td>\r\n                            <td style=\"width: 200px\">36 months</td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td style=\"width: 150px\">Interest Rate (APR)</td>\r\n                            <td style=\"width: 200px\">7.84%</td>\r\n                        </tr>\r\n                    </table>\r\n                </div>\r\n            \t\t\t\t\t\r\n            <div>\r\n                <p>\r\n                \r\n                    To proceed we require certain verification documents from you. Simply close this window and follow the online instructions.\r\n                    \r\n\r\n                This offer will expire on October 19, 2017.\r\n                </p>\r\n            </div>\r\n        \r\n        <p>\r\n            The consumer reporting agencies\r\n            referenced below did not make the decision and are\r\n            unable to provide you with the specific\r\n            reasons why your application was not approved.  However, since our decision was based in whole\r\n            or in part on information from these\r\n            consumer reporting agencies,\r\n            under the Fair Credit Reporting Act, you are entitled to know the information provided to us.\r\n            You also have the right to receive a free copy of your consumer report from the consumer\r\n            reporting agency, if you request it within 60 days of this notice.  In addition, you also\r\n            have the right to notify the consumer reporting agency and dispute the accuracy or completeness\r\n            of any information on your consumer report.  To receive this information, contact:\r\n        </p>\r\n\r\n        <div style=\"display:inline; page-break-inside:avoid;\">\r\n        <table style=\"margin-left: 20px; text-align: left;\">\r\n            <tr>\r\n                                \r\n                <td style=\"width: 200px\">\r\n                    Equifax<br />\r\n                    P.O. Box 740241<br />\r\n                    Atlanta, GA 30374-0241<br />\r\n                    800.685.1111\r\n                </td>\r\n                <td style=\"width: 30px\">\r\n                </td>\r\n                \r\n                <td style=\"width: 200px\">\r\n                    Experian<br />\r\n                    P.O. Box 2002<br />\r\n                    Allen, TX 75013-0036<br />\r\n                    888.397.3742\r\n                </td>\r\n                 \r\n            </tr>\r\n        </table>\r\n        </div>\r\n        \r\n        <p>\r\n            We also obtained your credit score from Equifax and used it in making our credit decision.\r\n            Your credit score is a number that reflects the information in your credit report.  Your\r\n            credit score can change, depending on how the information in your credit report changes.\r\n            <br/>\r\n            Your credit score: 669\r\n            <br/>\r\n            \r\n            Date: 1/28/2015\r\n            <br/>\r\n            \r\n            Score ranges from a low of 300 to a high of 850.\r\n            <br/>\r\n            Key factors that adversely affected your credit score:\r\n            <br/>\r\n        </p>\r\n        \r\n                <ul>\r\n            \r\n                <li>Proportion of balance to credit limits too high on bank/other revolving accts</li>\r\n            \r\n                <li>Proportion of loan balances to loan amounts is too high</li>\r\n            \r\n                <li>Too many inquiries within the last twelve months</li>\r\n            \r\n                <li>Length of time accounts have been established</li>\r\n            \r\n                </ul>\r\n            \r\n        \r\n        <p>\r\n            We also obtained your credit score from Experian and used it in making our credit decision.\r\n            Your credit score is a number that reflects the information in your credit report.  Your\r\n            credit score can change, depending on how the information in your credit report changes.\r\n            <br/>\r\n            Your credit score: 669\r\n            <br/>\r\n            \r\n            Date: 1/28/2015\r\n            <br/>\r\n            \r\n            Score ranges from a low of 300 to a high of 850.\r\n            <br/>\r\n            Key factors that adversely affected your credit score:\r\n        </p>\r\n\r\n        \r\n                <ul>\r\n            \r\n                <li>Proportion of loan balances to loan amounts is too high</li>\r\n            \r\n                <li>Too few accounts currently paid as agreed</li>\r\n            \r\n                <li>Length of time revolving accounts have been established</li>\r\n            \r\n                <li>Length of time accts have been established</li>\r\n            \r\n                </ul>\r\n            \r\n        \r\n                    \r\n    <div style=\"display:block; page-break-inside:avoid;\">\r\n        <br />\r\n        <br />\r\n        SunTrust Bank d/b/a LightStream\r\n        <br />\r\n        <br />\r\n    </div>\r\n    <hr style=\"line-height:1.3em;\" />\r\n    <div style=\"text-align: justify; display:block; page-break-inside:avoid;\">\r\n        The Federal Equal Credit Opportunity Act prohibits creditors from discriminating against credit applicants on the basis of race, color, religion, national origin, sex, marital status, age (provided the applicant has the capacity to enter into a binding contract); because all or part of the applicant's income derives from any public assistance program; or because the applicant has in good faith exercised any right under the Consumer Credit Protection Act. The Federal agency that administers compliance with this law concerning this creditor is the Bureau of Consumer Financial Protection, 1700 G Street NW., Washington, DC 20006.\r\n    </div>\r\n\r\n                                                    </div>\r\n                                                </td>\r\n                                            </tr>\r\n                                            \r\n                                        </table>\r\n                                    </td>\r\n                                </tr>\r\n\r\n                                <!-- Footer Content Row-->\r\n                                \r\n                            </table>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            </td>\r\n        </tr>\r\n    </table>\r\n</body>\r\n</html>\r\n";
            string actual = FixUpEdocHtml(original);

            Assert.AreEqual("<style type=\"text/css\">\r\n        @media only screen and (max-width: 480px) {\r\n            /* mobile-specific CSS styles go here */\r\n            table[class=email], table[class=email-content] {\r\n                clear: both;\r\n                width: 320px !important;\r\n                font-size: 13px !important;\r\n            }\r\n\r\n            .email-header {\r\n                margin-bottom: 10px !important;\r\n            }\r\n        }\r\n    </style><table id=\"bodyTable\" class=\"email\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" height=\"100%\" width=\"97%\" align=\"center\"><tr><td align=\"center\" valign=\"top\"><table class=\"email-content\" border=\"0\" cellpadding=\"20\" cellspacing=\"0\" id=\"emailContainer\"><tr><!-- fluid container up to 660px --><td width=\"660\"><table cellspacing=\"0\" cellpadding=\"0\" border=\"0\"><!-- Header Content Row --><tr><td align=\"center\" valign=\"top\"><table class=\"email-header\" style=\"padding-bottom: 20px\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\"><tr><td align=\"center\" valign=\"top\"><!-- header content goes in here --><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\"></table></td></tr></table></td></tr><!-- Main Content Row --><tr><td align=\"center\" valign=\"top\"><!-- main content goes in here --><table><tr><td style=\"vertical-align: top; padding: 0px 7px 0px 7px;\"><div style=\"font-family: Arial, Helvetica, sans-serif; font-size: 10pt; text-align: justify;\"><br /><br />\r\n        September 27, 2017\r\n        <br /><br />\r\n        Reference ID 11177902\r\n        <br /><br /><br /><br />\r\n    \r\n\r\n        Dear Tester Tester,\r\n        <br /><br />\r\n    \r\n                    Thank you for applying for an installment loan.\r\n                 After reviewing your application, we regret that we are unable\r\n            to approve your request based on the following\r\n    reason:\r\n        \r\n                <ul><li>Insufficient credit history</li></ul><div id=\"ctl00_EmailContent_uxCounterTermsDiv\" style=\"display:inline; page-break-inside:avoid;\">\r\n                    However, we are able to offer you credit on the following terms:\r\n                    <p /><table style=\"margin-left: 20px; text-align: left;\"><tr><td style=\"width: 150px\">Amount</td><td style=\"width: 200px\">$29,500.00</td></tr><tr><td style=\"width: 150px\">Term</td><td style=\"width: 200px\">36 months</td></tr><tr><td style=\"width: 150px\">Interest Rate (APR)</td><td style=\"width: 200px\">7.84%</td></tr></table></div><div><p>\r\n                \r\n                    To proceed we require certain verification documents from you. Simply close this window and follow the online instructions.\r\n                    \r\n\r\n                This offer will expire on October 19, 2017.\r\n                </p></div><p>\r\n            The consumer reporting agencies\r\n            referenced below did not make the decision and are\r\n            unable to provide you with the specific\r\n            reasons why your application was not approved.  However, since our decision was based in whole\r\n            or in part on information from these\r\n            consumer reporting agencies,\r\n            under the Fair Credit Reporting Act, you are entitled to know the information provided to us.\r\n            You also have the right to receive a free copy of your consumer report from the consumer\r\n            reporting agency, if you request it within 60 days of this notice.  In addition, you also\r\n            have the right to notify the consumer reporting agency and dispute the accuracy or completeness\r\n            of any information on your consumer report.  To receive this information, contact:\r\n        </p><div style=\"display:inline; page-break-inside:avoid;\"><table style=\"margin-left: 20px; text-align: left;\"><tr><td style=\"width: 200px\">\r\n                    Equifax<br />\r\n                    P.O. Box 740241<br />\r\n                    Atlanta, GA 30374-0241<br />\r\n                    800.685.1111\r\n                </td><td style=\"width: 30px\"></td><td style=\"width: 200px\">\r\n                    Experian<br />\r\n                    P.O. Box 2002<br />\r\n                    Allen, TX 75013-0036<br />\r\n                    888.397.3742\r\n                </td></tr></table></div><p>\r\n            We also obtained your credit score from Equifax and used it in making our credit decision.\r\n            Your credit score is a number that reflects the information in your credit report.  Your\r\n            credit score can change, depending on how the information in your credit report changes.\r\n            <br />\r\n            Your credit score: 669\r\n            <br />\r\n            \r\n            Date: 1/28/2015\r\n            <br />\r\n            \r\n            Score ranges from a low of 300 to a high of 850.\r\n            <br />\r\n            Key factors that adversely affected your credit score:\r\n            <br /></p><ul><li>Proportion of balance to credit limits too high on bank/other revolving accts</li><li>Proportion of loan balances to loan amounts is too high</li><li>Too many inquiries within the last twelve months</li><li>Length of time accounts have been established</li></ul><p>\r\n            We also obtained your credit score from Experian and used it in making our credit decision.\r\n            Your credit score is a number that reflects the information in your credit report.  Your\r\n            credit score can change, depending on how the information in your credit report changes.\r\n            <br />\r\n            Your credit score: 669\r\n            <br />\r\n            \r\n            Date: 1/28/2015\r\n            <br />\r\n            \r\n            Score ranges from a low of 300 to a high of 850.\r\n            <br />\r\n            Key factors that adversely affected your credit score:\r\n        </p><ul><li>Proportion of loan balances to loan amounts is too high</li><li>Too few accounts currently paid as agreed</li><li>Length of time revolving accounts have been established</li><li>Length of time accts have been established</li></ul><div style=\"display:block; page-break-inside:avoid;\"><br /><br />\r\n        SunTrust Bank d/b/a LightStream\r\n        <br /><br /></div><hr style=\"line-height:1.3em;\" /><div style=\"text-align: justify; display:block; page-break-inside:avoid;\">\r\n        The Federal Equal Credit Opportunity Act prohibits creditors from discriminating against credit applicants on the basis of race, color, religion, national origin, sex, marital status, age (provided the applicant has the capacity to enter into a binding contract); because all or part of the applicant's income derives from any public assistance program; or because the applicant has in good faith exercised any right under the Consumer Credit Protection Act. The Federal agency that administers compliance with this law concerning this creditor is the Bureau of Consumer Financial Protection, 1700 G Street NW., Washington, DC 20006.\r\n    </div></div></td></tr></table></td></tr><!-- Footer Content Row--></table></td></tr></table></td></tr></table>", actual);
        }
    }
}
